<!-- TODO: Standardize use of "race" and "contest" -->

{#if !loaded}
  <div class="loading contest-loading">Loading...</div>
{:else}
  <div class="race-party party-{ party.id } contest-{ id } { uncontested ? 'uncontested' : '' }" id="{ id }">
    <div class="race-party-chat">
      <h6>{ title }</h6>

      <p>Let's put a touch more of the magic here. Get away from those little Christmas tree things we used to make in school. Every highlight needs it's own personal shadow. Follow the lay of the land. It's most important.</p>
    </div>

    <div class="race-party-table">
      <table>
        <thead>
          <tr>
            <th></th>
            <th class="cand">Candidates</th>
            <th class="votes">Votes</th>
            <th class="pct">Pct.</th>
            <th class="bar"></th>
          </tr>
        </thead>
        <tbody>
          {#each results as r}
            <tr class="{ r.winner ? 'winner' : '' }">
              <td class="winner">{#if r.winner}&#10004;{/if}</td>
              <td class="cand">{ r.candidate.fullName }</td>
              <td class="votes">{ r.votes }</td>
              <td class="pct">{ round(r.percent * 100) }%</td>
              <td class="bar">
                <span class="pctBar" style="width: { r.percent * 100 }%; background-color: #EB6868;"></span>
                </td>
            </tr>
          {/each}
        </tbody>
      </table>

      <div class="reporting">60% of precincts reporting</div>
    </div>

    <!-- <div id="r-gov-map" class="mapcanvas">
      <svg width="400" height="400"></svg>
    </div> -->
  </div>
{/if}

<script>
  export default {
    oncreate() {
      // Check for ID
      if (!this.get().id) {
        // TODO: Handle
        return;
      }

      window
        .fetch(
          `//static.startribune.com/elections/civix/mn-20180814/contests/${
            this.get().id
          }.json`
        )
        .then(response => {
          return response.json();
        })
        .then(contest => {
          this.set(contest);
          this.set({ loaded: true });
        })
        .catch(e => {
          // TODO: Handle error
          console.error(e);
        });
    },

    helpers: {
      round(input, decimals = 1) {
        if (parseFloat(input) !== NaN) {
          return (
            Math.round(parseFloat(input) * Math.pow(10, decimals)) /
            Math.pow(10, decimals)
          );
        }
      }
    }
  };
</script>
